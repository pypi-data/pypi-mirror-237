(function(){"use strict";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const q=Symbol("Comlink.proxy"),G=Symbol("Comlink.endpoint"),Y=Symbol("Comlink.releaseProxy"),O=Symbol("Comlink.finalizer"),x=Symbol("Comlink.thrown"),U=t=>typeof t=="object"&&t!==null||typeof t=="function",B={canHandle:t=>U(t)&&t[q],serialize(t){const{port1:e,port2:r}=new MessageChannel;return C(t,e),[r,[r]]},deserialize(t){return t.start(),K(t)}},X={canHandle:t=>U(t)&&x in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},_=new Map([["proxy",B],["throw",X]]);function $(t,e){for(const r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function C(t,e=globalThis,r=["*"]){e.addEventListener("message",function h(s){if(!s||!s.data)return;if(!$(r,s.origin)){console.warn(`Invalid origin '${s.origin}' for comlink proxy`);return}const{id:o,type:a,path:n}=Object.assign({path:[]},s.data),i=(s.data.argumentList||[]).map(E);let c;try{const u=n.slice(0,-1).reduce((l,w)=>l[w],t),g=n.reduce((l,w)=>l[w],t);switch(a){case"GET":c=g;break;case"SET":u[n.slice(-1)[0]]=E(s.data.value),c=!0;break;case"APPLY":c=g.apply(u,i);break;case"CONSTRUCT":{const l=new g(...i);c=tt(l)}break;case"ENDPOINT":{const{port1:l,port2:w}=new MessageChannel;C(t,w),c=z(l,[l])}break;case"RELEASE":c=void 0;break;default:return}}catch(u){c={value:u,[x]:0}}Promise.resolve(c).catch(u=>({value:u,[x]:0})).then(u=>{const[g,l]=L(u);e.postMessage(Object.assign(Object.assign({},g),{id:o}),l),a==="RELEASE"&&(e.removeEventListener("message",h),j(e),O in t&&typeof t[O]=="function"&&t[O]())}).catch(u=>{const[g,l]=L({value:new TypeError("Unserializable return value"),[x]:0});e.postMessage(Object.assign(Object.assign({},g),{id:o}),l)})}),e.start&&e.start()}function J(t){return t.constructor.name==="MessagePort"}function j(t){J(t)&&t.close()}function K(t,e){return f(t,[],e)}function I(t){if(t)throw new Error("Proxy has been released and is not useable")}function W(t){return P(t,{type:"RELEASE"}).then(()=>{j(t)})}const R=new WeakMap,F="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(R.get(t)||0)-1;R.set(t,e),e===0&&W(t)});function Q(t,e){const r=(R.get(e)||0)+1;R.set(e,r),F&&F.register(t,e,t)}function Z(t){F&&F.unregister(t)}function f(t,e=[],r=function(){}){let h=!1;const s=new Proxy(r,{get(o,a){if(I(h),a===Y)return()=>{Z(s),W(t),h=!0};if(a==="then"){if(e.length===0)return{then:()=>s};const n=P(t,{type:"GET",path:e.map(i=>i.toString())}).then(E);return n.then.bind(n)}return f(t,[...e,a])},set(o,a,n){I(h);const[i,c]=L(n);return P(t,{type:"SET",path:[...e,a].map(u=>u.toString()),value:i},c).then(E)},apply(o,a,n){I(h);const i=e[e.length-1];if(i===G)return P(t,{type:"ENDPOINT"}).then(E);if(i==="bind")return f(t,e.slice(0,-1));const[c,u]=v(n);return P(t,{type:"APPLY",path:e.map(g=>g.toString()),argumentList:c},u).then(E)},construct(o,a){I(h);const[n,i]=v(a);return P(t,{type:"CONSTRUCT",path:e.map(c=>c.toString()),argumentList:n},i).then(E)}});return Q(s,t),s}function S(t){return Array.prototype.concat.apply([],t)}function v(t){const e=t.map(L);return[e.map(r=>r[0]),S(e.map(r=>r[1]))]}const D=new WeakMap;function z(t,e){return D.set(t,e),t}function tt(t){return Object.assign(t,{[q]:!0})}function L(t){for(const[e,r]of _)if(r.canHandle(t)){const[h,s]=r.serialize(t);return[{type:"HANDLER",name:e,value:h},s]}return[{type:"RAW",value:t},D.get(t)||[]]}function E(t){switch(t.type){case"HANDLER":return _.get(t.name).deserialize(t.value);case"RAW":return t.value}}function P(t,e,r){return new Promise(h=>{const s=nt();t.addEventListener("message",function o(a){!a.data||!a.data.id||a.data.id!==s||(t.removeEventListener("message",o),h(a.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:s},e),r)})}function nt(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}const et=(t,e,r)=>{const h=new Float32Array(t),s=new Float32Array(t),o=new Float32Array(t),a=new Uint32Array(t);let n;switch(e){case"bartlett":for(n=0;n<t;n++)o[n]=2/(t-1)*((t-1)/2-Math.abs(n-(t-1)/2));break;case"bartlettHann":for(n=0;n<t;n++)o[n]=.62-.48*Math.abs(n/(t-1)-.5)-.38*Math.cos(Math.PI*2*n/(t-1));break;case"blackman":for(r=r||.16,n=0;n<t;n++)o[n]=(1-r)/2-.5*Math.cos(Math.PI*2*n/(t-1))+r/2*Math.cos(4*Math.PI*n/(t-1));break;case"cosine":for(n=0;n<t;n++)o[n]=Math.cos(Math.PI*n/(t-1)-Math.PI/2);break;case"gauss":for(r=r||.25,n=0;n<t;n++)o[n]=Math.pow(Math.E,-.5*Math.pow((n-(t-1)/2)/(r*(t-1)/2),2));break;case"hamming":for(n=0;n<t;n++)o[n]=.54-.46*Math.cos(Math.PI*2*n/(t-1));break;case"hann":case void 0:for(n=0;n<t;n++)o[n]=.5*(1-Math.cos(Math.PI*2*n/(t-1)));break;case"lanczoz":for(n=0;n<t;n++)o[n]=Math.sin(Math.PI*(2*n/(t-1)-1))/(Math.PI*(2*n/(t-1)-1));break;case"rectangular":for(n=0;n<t;n++)o[n]=1;break;case"triangular":for(n=0;n<t;n++)o[n]=2/t*(t/2-Math.abs(n-(t-1)/2));break;default:throw Error("No such window function '"+e+"'")}let i=1,c=t>>1;for(;i<t;){for(n=0;n<i;n++)a[n+i]=a[n]+c;i=i<<1,c=c>>1}for(n=0;n<t;n++)h[n]=Math.sin(-Math.PI/n),s[n]=Math.cos(-Math.PI/n);return{sinTable:h,cosTable:s,windowValues:o,reverseTable:a}},rt=(t,e,r,h,s,o)=>{const a=new Float32Array(e),n=new Float32Array(e),i=2/e,c=Math.sqrt,u=new Float32Array(e/2);let g,l,w;const N=Math.floor(Math.log(e)/Math.LN2);if(Math.pow(2,N)!==e)throw new Error("Invalid buffer size, must be a power of 2.");if(e!==t.length)throw new Error("Supplied buffer is not the same size as defined FFT. FFT Size: "+e+" Buffer Size: "+t.length);let y=1,k,d,T,A,p,b,H,V;for(let m=0;m<e;m++)a[m]=t[r[m]]*h[r[m]],n[m]=0;for(;y<e;){k=o[y],d=s[y],T=1,A=0;for(let m=0;m<y;m++){let M=m;for(;M<e;)p=M+y,b=T*a[p]-A*n[p],H=T*n[p]+A*a[p],a[p]=a[M]-b,n[p]=n[M]-H,a[M]+=b,n[M]+=H,M+=y<<1;V=T,T=V*k-A*d,A=V*d+A*k}y=y<<1}for(let m=0,M=e/2;m<M;m++)g=a[m],l=n[m],w=i*c(g*g+l*l),u[m]=w;return u};C((t,e,r,h,s,o)=>{const a=[],n=o.length/h,i=Math.min(s-1,Math.round(Math.max(0,s-n))),c=et(t,e,r),u=1;for(let g=0;g<u;g++){const l=[];let w=0;for(;w+s<o.length;){const N=o.slice(w,w+s),y=rt(N,t,c.reverseTable,c.windowValues,c.sinTable,c.cosTable),k=new Uint8Array(s/2);let d;for(d=0;d<s/2;d++)k[d]=Math.max(-255,Math.log10(y[d])*45);l.push(k),w+=s-i}a.push(l)}return a[0]})})();
