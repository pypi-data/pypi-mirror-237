(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[925],{6925:function(e,t,n){"use strict";n.r(t),n.d(t,{Correspondence:function(){return Y},default:function(){return q}});var r=n(5893),o=n(9999),i=n(8347),a=n(6265),s=n(4121),l=n(7294),c=n(5172),u=n(4404),d=n(7201),h=(n(1298),n(7149),n(7643),n(800)),p=n.n(h),f=n(8440),m=n.n(f),v=n(5644),g=n.n(v),y=n(4839),b=n(423),x=n(3234),k=n(2708);function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var j,S=(0,l.memo)((function(e){var t=e.points,n=e.lineOpactiy,o=e.pointOpacity,a=e.stroke,s=e.strokeWidth,l=e.radius,c=void 0===l?1:l,u=e.shadowBlur,h=e.shadowForStrokeEnabled,p=(0,i.Z)(e,["points","lineOpactiy","pointOpacity","stroke","strokeWidth","radius","shadowBlur","shadowForStrokeEnabled"]);return(0,r.jsxs)(d.ZA,O(O({},p),{},{children:[(0,r.jsx)(d.x1,{shadowForStrokeEnabled:h,points:t,stroke:a,strokeWidth:s,shadowBlur:u,opacity:n}),(0,r.jsx)(d.Cd,{x:t[0],y:t[1],stroke:a,strokeWidth:s,radius:c,shadowBlur:u,opacity:o,shadowForStrokeEnabled:h}),(0,r.jsx)(d.Cd,{x:t[2],y:t[3],stroke:a,strokeWidth:s,radius:c,shadowBlur:u,opacity:o,shadowForStrokeEnabled:h})]}))})),E=n(5076),C=(0,l.memo)((function(e){var t=e.total,n=e.shown,o=(0,i.Z)(e,["total","shown"]);return(0,r.jsxs)(E.K,{styles:M,children:[(0,r.jsxs)("span",{children:["matches shown: ",n," / ",t]}),(0,k.ih)(o)]})})),M={root:{position:"absolute",left:0,bottom:0,pointerEvents:"none",padding:x.r.spacing.s1,textShadow:"0 0 1px black",color:x.r.palette.neutralLight,fontFamily:"monospace",zIndex:1}},Z=(0,l.memo)((function(e){var t=e.index,n=e.kpt0,o=e.kpt1,a=(0,i.Z)(e,["index","kpt0","kpt1"]);return(0,r.jsxs)(E.K,{styles:P,children:[(0,r.jsxs)("span",{children:["highlighted index: ",t]}),(0,r.jsxs)("span",{children:["keypoints: (",n.join(", "),") \u2192 (",o.join(", "),")"]}),(0,k.ih)(a)]})})),P={root:{position:"absolute",top:0,left:0,pointerEvents:"none",padding:x.r.spacing.s1,textShadow:"0 0 1px black",fontFamily:"monospace",color:x.r.palette.neutralLight,zIndex:1}},N=n(7918),F=n(4751),D=n(2927),T=n(9942),B=n(7283),I=(0,l.memo)((function(e){var t=e.hidden,n=e.onDismiss,o=e.text,i=e.onSave,a=(0,l.useRef)(o),s=(0,l.useCallback)((function(e,t){return a.current=t}),[]),c=(0,l.useCallback)((function(){return i(a.current)}),[i]);return(0,r.jsxs)(N.V,{title:"Edit Color Mapping Function",hidden:t,maxWidth:"80vw",dialogContentProps:W,onDismiss:n,children:[(0,r.jsxs)(F.x,{children:["The color mapping has a signature of",(0,r.jsxs)("pre",{style:A,children:["(palette: (index: number) => string, min: number, max: number, val: number, i: number) => string",(0,r.jsx)("br",{}),"@param palette: given an index of range [0, 1] returns the corresponding color from the choosen colormap.",(0,r.jsx)("br",{}),"@param min: the minimum metric value of all keypoints.",(0,r.jsx)("br",{}),"@param max: the maxinum metric value of all keypoints.",(0,r.jsx)("br",{}),"@param localMax: the maximum value of the top 95% of the metric after sorting from small to large",(0,r.jsx)("br",{}),"@param val: the metric value of the current keypoint.",(0,r.jsx)("br",{}),"@param i: the index of the keypoint.",(0,r.jsx)("br",{}),'@returns: a color string, e.g. "green", "#00ff00", "rgb(0,255,0)", "rgba(0,255,0,0.5)"']})]}),(0,r.jsx)(D.n,{multiline:!0,rows:10,defaultValue:o,onChange:s}),(0,r.jsx)(T.c,{children:(0,r.jsx)(B.K,{text:"Save",onClick:c})})]})})),W={showCloseButton:!0,isMultiline:!0,styles:{subText:x.r.fonts.large,inner:{overflow:"hidden"},innerContent:{overflow:"auto"}},subText:"You can write your own function body to get the color for each keypoint. (Requires basic knowledge of javascript.)"},A={paddingLeft:12,lineHeight:1.5,color:x.r.palette.green};function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return X(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return X(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var z={img0:"",img1:"",kpts0:[],kpts1:[],unmatched_kpts0:[],unmatched_kpts1:[],metrics:{},booleans:{},meta:{}},H={width:0,height:0,scaleToFit:1,offsetTop:0,offsetLeft:0},K={width:"100%",height:"100%",display:"flex",alignItems:"center",background:x.r.palette.neutralSecondary},R={paddingLeft:16},U=null!==(j=JSON.parse(localStorage.getItem("colorFuncBody")))&&void 0!==j?j:"return palette(val / max);",V=Object.keys(m()),Y=(0,l.memo)((function(e){var t,n,h,f,m,v,w,O,j,E=e.url,M=e.store,P=(0,b.J6)(E,"GET","json",z),N=P.img0,F=P.img1,D=P.kpts0,T=P.kpts1,B=P.unmatched_kpts0,W=void 0===B?[]:B,A=P.unmatched_kpts1,J=void 0===A?[]:A,X=P.metrics,Y=void 0===X?{}:X,q=P.booleans,G=void 0===q?{}:q,$=P.meta,Q=void 0===$?{}:$,ee=(0,l.useRef)(),te=(0,l.useRef)(),ne=(0,l.useRef)(),re=(0,u.k)(!0),oe=(0,s.Z)(re,2),ie=oe[0],ae=oe[1],se=ae.setFalse,le=ae.setTrue,ce=(0,u.k)(!0),ue=(0,s.Z)(ce,2),de=ue[0],he=ue[1],pe=he.setFalse,fe=he.setTrue,me=(0,l.useState)(H),ve=me[0],ge=ve.width,ye=ve.height,be=ve.offsetTop,xe=ve.offsetLeft,ke=me[1],we=(0,l.useState)(void 0),Oe=we[0],je=we[1],Se=(0,l.useState)(void 0),Ee=Se[0],Ce=Se[1],Me=(0,l.useState)(U),Ze=Me[0],Pe=Me[1],Ne=(0,l.useMemo)((function(){return Function("palette","min","max","localMax","val","i",Ze)}),[Ze]),Fe=(0,l.useState)({}),De=Fe[0],Te=Fe[1],Be=(0,l.useState)({}),Ie=Be[0],We=Be[1],Ae=(0,b.Hn)([N,F]),Je=(0,s.Z)(Ae,2),Le=Je[0],_e=Je[1],Xe=(0,l.useCallback)((function(e){var t;je(null===(t=e.target.parent)||void 0===t?void 0:t.attrs.index)}),[]),ze=(0,l.useCallback)((function(e){var t;Ce(null===(t=e.target.parent)||void 0===t?void 0:t.attrs.index),e.cancelBubble=!0}),[]),He=(0,l.useCallback)((function(e){e.evt.preventDefault();var t=e.currentTarget.getStage();ne.current&&(clearTimeout(ne.current),ne.current=void 0),t.container().style.cursor=e.evt.deltaY<0?"zoom-in":"zoom-out",pe();var n=t.scaleX(),r=e.evt.deltaY<0;if(!(r&&n>=3||!r&&n<=.3)){var o=r?1.01*n:n/1.01;o>3&&(o=3),o<.3&&(o=.3);var i=t.getPointerPosition();(0,k.sP)(t,o,i,M),ne.current=window.setTimeout((function(){fe(),t.container().style.cursor="default",ne.current=void 0}),150)}}),[M]),Ke=(0,l.useCallback)((function(e){pe(),e.currentTarget.getStage().container().style.cursor="move"}),[]),Re=(0,l.useCallback)((function(e){fe(),e.currentTarget.getStage().container().style.cursor="default"}),[]),Ue=(0,l.useCallback)((function(){Ce(void 0),je(void 0)}),[]);(0,c.y)("Escape",Ue),(0,l.useEffect)(Ue,[E]),(0,l.useEffect)((function(){if(_e){var e=ee.current.container(),t=function(){var t=(0,s.Z)(Le,2),n=t[0],r=t[1],o=n.width+r.width,i=Math.max(n.height,r.height),a=Math.min(e.clientWidth/o,e.clientHeight/i),l=(e.clientWidth-a*o)/2,c=(e.clientHeight-a*i)/2;ke({width:e.clientWidth,height:e.clientHeight,scaleToFit:a,offsetLeft:l,offsetTop:c}),te.current=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=ee.current,r=n.scaleX();if(e){var s=r*(o+2*l)/2,u=r*(i+2*c)/2,d={x:n.x()+s,y:n.y()+u};(0,k.sP)(n,e,d,t?M:void 0)}else M.setValueAtPath("scale",a,!1),n.position({x:0,y:0})},1===M.get("scale")&&M.setValueAtPath("scale",a,!1)};t();var n=new ResizeObserver(t);return n.observe(e),function(){n.unobserve(e),je(void 0),Ce(void 0)}}}),[_e,M]);var Ve=(0,y.M4)({background:{hint:"background",value:null!==(t=JSON.parse(localStorage.getItem("background")))&&void 0!==t?t:x.r.palette.neutralSecondary,onChange:function(e,t,n){ee.current.container().style.background=e}},scale:{hint:"scale",min:.3,max:3,step:.01,value:1,transient:!1,onEditStart:pe,onEditEnd:fe,onChange:function(e,t,n){!n.initial&&n.fromPanel&&te.current(e,!1)}}," ":(0,y.DN)({opts:{reset:function(){return te.current()},"0.5x":function(){return te.current(.5)},"1.0x":function(){return te.current(1)},"2.0x":function(){return te.current(2)}}}),strokeWidth:{label:"stroke width (px)",hint:"stroke width (px)",min:.01,max:5,step:.01,value:null!==(n=JSON.parse(localStorage.getItem("strokeWidth")))&&void 0!==n?n:2},lineOpacity:{label:"line opacity",hint:"line opacity",min:0,max:1,step:.01,value:null!==(h=JSON.parse(localStorage.getItem("lineOpacity")))&&void 0!==h?h:.4},pointOpacity:{label:"point opacity",hint:"point opacity",min:0,max:1,step:.01,value:null!==(f=JSON.parse(localStorage.getItem("pointOpacity")))&&void 0!==f?f:.4},showUnmatchedKeypoints:{label:"show unmatched keypoints",hint:"show unmatched keypoints",value:null===(m=JSON.parse(localStorage.getItem("showUnmatchedKeypoints")))||void 0===m||m},showAllMatches:{label:"show all matches",hint:"show all matches",value:null===(v=JSON.parse(localStorage.getItem("showAllMatches")))||void 0===v||v}},{store:M}),Ye=Ve.scale,qe=Ve.strokeWidth,Ge=Ve.lineOpacity,$e=Ve.pointOpacity,Qe=Ve.showUnmatchedKeypoints,et=Ve.showAllMatches,tt=(0,l.useMemo)((function(){return[Object.keys(Y),Object.keys(G)]}),[Y,G]),nt=tt[0],rt=tt[1];(0,y.M4)((function(){var e,t={},n=_(rt);try{var o=function(){var n=e.value;t[n]={type:y.gX.BOOLEAN,label:n,hint:n,value:!1,onChange:function(e,t,r){We((function(t){return L(L({},t),{},(0,a.Z)({},n,L(L({},t[n]),{},{enabled:e})))})),Ue()}},t[n+"_inverted"]={type:y.gX.BOOLEAN,label:(0,r.jsx)("span",{style:R,children:"inverted"}),value:!1,render:function(e){return e(n)},onChange:function(e,t,r){We((function(t){return L(L({},t),{},(0,a.Z)({},n,L(L({},t[n]),{},{inverted:e})))}))}}};for(n.s();!(e=n.n()).done;)o()}catch(i){n.e(i)}finally{n.f()}return t}),{store:M},[rt]);var ot=["customize func","error color func"],it=(0,y.M4)((function(){var e,t={};Object.keys(Y).length&&(t.showMatchesBy={type:y.gX.SELECT,label:"show matches by",options:ot,value:null!==(e=JSON.parse(localStorage.getItem("showMatchesBy")))&&void 0!==e?e:ot[0]});return t}),{store:M},[Y]),at=(0,s.Z)(it,1)[0].showMatchesBy,st=void 0===at?"":at,lt=(0,y.M4)((function(){var e,t={};st==ot[1]&&(t.thr={label:"thresholds",hint:"thresholds",min:0,max:50,value:null!==(e=JSON.parse(localStorage.getItem("thr")))&&void 0!==e?e:5,step:.1});return t}),{store:M},[st]),ct=(0,s.Z)(lt,1)[0].thr,ut=(0,y.M4)((function(){var e,t={},n=Object.keys(Y);st==ot[0]&&(t.colormap={hint:"colormap",options:V,value:null!==(e=JSON.parse(localStorage.getItem("colormap")))&&void 0!==e?e:V[0]},t.colorFuncBodyControl=(0,y.DN)({label:"color func",opts:{edit:se}}));if(n.length&&(t.metricName={type:y.gX.SELECT,label:"colored by",options:n,value:n[0]},!et&&st==ot[0]))for(var r in Y){var i=Math.min.apply(Math,(0,o.Z)(Y[r])),s=Math.max.apply(Math,(0,o.Z)(Y[r]));t[r]={label:r,hint:r,min:i,max:s,value:[i,s],onEditEnd:function(e,t,n){Te((function(n){return L(L({},n),{},(0,a.Z)({},t,e))})),Ue()}}}return t}),{store:M},[Y,et,st]),dt=(0,s.Z)(ut,2),ht=dt[0],pt=ht.colormap,ft=(ht.colorFuncBodyControl,ht.metricName),mt=void 0===ft?"":ft,vt=(0,i.Z)(ht,["colormap","colorFuncBodyControl","metricName"]),gt=dt[1],yt=function(e){Te((function(t){return L(L({},t),{},(0,a.Z)({},e,vt[e]))})),Ue()};(0,l.useEffect)((function(){var e=Object.keys(Y);if(e.length&&(gt({metricName:e[0]}),!et&&st==ot[0]))for(var t in vt)gt((0,a.Z)({},t,yt(t))),gt((0,a.Z)({},t,yt(t)))}),[Y,et,st]);var bt=(0,l.useMemo)((function(){return _e?D.map((function(e,t){return[e[0],e[1],T[t][0]+Le[0].width,T[t][1]]})):[]}),[D,T,_e,null===(w=Le[0])||void 0===w?void 0:w.width]),xt=(0,l.useMemo)((function(){return _e?[].concat((0,o.Z)(W),(0,o.Z)(J.map((function(e){return[e[0]+Le[0].width,e[1]]})))):[]}),[W,J,_e,null===(O=Le[0])||void 0===O?void 0:O.width]),kt=Y[mt],wt=(0,l.useMemo)((function(){if(kt){if(st==ot[0]){var e=g()(p()({colormap:pt})),t=Math.min.apply(Math,(0,o.Z)(kt)),n=Math.max.apply(Math,(0,o.Z)(kt)),r=JSON.parse(JSON.stringify(kt));r.sort((function(e,t){return e-t}));var i=r[Math.ceil(.95*r.length)-1];return kt.map((function(r,o){return Ne(e,t,n,i,r,o)||function(e,t,n,r,o){return e(r/n)}(e,0,n,r)}))}return kt.map((function(e,t){return function(e,t){var n,r,o,i=1-(o=1,(n=e/(2*ct))<=(r=0)?r:n>=o?o:n),a=2*i*255;return"rgb(".concat(255*(2-2*i),",").concat(a,",").concat(0,")")}(e)}))}return new Array(D.length).fill("#ff00000")}),[kt,D.length,pt,Ne,ct]),Ot=(0,l.useCallback)((function(e){Pe(e),le(),localStorage.setItem("colorFuncBody",JSON.stringify(e))}),[]),jt=(0,l.useMemo)((function(){return _e?D.reduce((function(e,t,n){var r=!(!et&&st!=ot[1])||Object.entries(De).every((function(e){var t=(0,s.Z)(e,2),r=t[0],o=(0,s.Z)(t[1],2),i=o[0],a=o[1];return function(e,t,n,r){return!Y[e]||(0,k.Od)(Y[e][t],n,r)}(r,n,i,a)})),o=Object.entries(Ie).every((function(e){var t=(0,s.Z)(e,2),r=t[0],o=t[1],i=o.enabled,a=o.inverted;return!i||(a?!G[r][n]:G[r][n])}));return r&&o&&e.push(n),e}),[]):[]}),[D,Y,G,De,Ie,_e,et,st]),St=(0,l.useMemo)((function(){return jt.map((function(e){return(0,r.jsx)(S,{index:e,points:bt[e],lineOpactiy:Ge,pointOpacity:$e,stroke:wt[e],strokeWidth:qe,radius:1,shadowForStrokeEnabled:!1},e)}))}),[jt,bt,wt,Ge,$e,qe]),Et=void 0===Oe?Ee:Oe,Ct=de&&void 0===Ee,Mt=de;return(0,r.jsxs)(r.Fragment,{children:[ie||(0,r.jsx)(I,{hidden:ie,text:Ze,onDismiss:le,onSave:Ot}),N&&(0,r.jsx)(C,L({shown:jt.length,total:D.length},Q)),D[Et]&&(0,r.jsx)(Z,L({index:Et,kpt0:D[Et],kpt1:T[Et]},Object.fromEntries(nt.map((function(e){return[e,Y[e][Et]]})).concat(rt.map((function(e){var t;return[e,null===(t=G[e][Et])||void 0===t?void 0:t.toString()]})))))),(0,r.jsxs)(d.Hf,{draggable:!0,ref:ee,width:ge,height:ye,scaleX:Ye,scaleY:Ye,onWheel:He,onClick:Xe,onDblClick:Ue,style:K,onDragStart:Ke,onDragEnd:Re,children:[(0,r.jsxs)(d.mh,{name:"imageLayer",listening:!1,x:xe,y:be,children:[(0,r.jsx)(d.Ee,{x:0,y:0,image:Le[0]}),(0,r.jsx)(d.Ee,{x:(null===(j=Le[0])||void 0===j?void 0:j.width)||0,y:0,image:Le[1]}),Qe&&xt.map((function(e,t){var n=(0,s.Z)(e,2),o=n[0],i=n[1];return(0,r.jsx)(d.Cd,{x:o,y:i,stroke:"#ff0000",strokeWidth:qe,radius:1},t)}))]}),(0,r.jsx)(d.mh,{name:"linesLayer",x:xe,y:be,listening:Ct,visible:Ct,onMouseEnter:Xe,onDblClick:ze,children:St}),(0,r.jsx)(d.mh,{name:"highlightLayer",x:xe,y:be,visible:Mt,listening:Mt,children:bt[Ee]?(0,r.jsx)(S,{index:Ee,points:bt[Ee],stroke:wt[Ee],strokeWidth:qe}):bt[Oe]&&(0,r.jsx)(S,{index:Oe,points:bt[Oe],stroke:wt[Oe],shadowBlur:5,strokeWidth:qe,onDblClick:ze})})]})]})})),q=Y}}]);