"use strict";(self.webpackChunkgrist_widget=self.webpackChunkgrist_widget||[]).push([[292],{292:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var o=n(47);const i=function(){const e=new URL("../files/package.tar.gz",window.location.href).href;return`\nasync def __bootstrap_grist(url):\n    from pyodide.http import pyfetch  # noqa\n    import io\n    import tarfile\n    \n    response = await pyfetch(url)\n    bytes_file = io.BytesIO(await response.bytes())\n    with tarfile.open(fileobj=bytes_file) as tar:\n        tar.extractall()\n    \n    import grist.browser  # noqa\n    return grist.browser.grist\n\ngrist = await __bootstrap_grist(${JSON.stringify(e)})\n`};var s=n(854);const r=[];class a extends Worker{constructor(e,t){super(e,t);const{grist:n}=window;n?p(this,n):r.push(this)}}window.Worker=a;const l={content:{metadata:{language_info:{codemirror_mode:{name:"python",version:3},file_extension:".py",mimetype:"text/x-python",name:"python",nbconvert_exporter:"python",pygments_lexer:"ipython3",version:"3.11"},kernelspec:{name:"python",display_name:"Python (Pyodide)",language:"python"}},nbformat_minor:4,nbformat:4,cells:[{cell_type:"code",source:"",metadata:{},execution_count:null,outputs:[]}]},format:"json"};let c=null;async function d(e){return new Promise((t=>setTimeout(t,e)))}function p(e,t){o.expose({grist:{...t,getTable:e=>o.proxy(t.getTable(e)),getCurrentRecord:()=>c}},e)}const u={id:"grist-widget:plugin",description:"Custom Grist widget for a JupyterLite notebook",autoStart:!0,requires:[s.IFileBrowserCommands],activate:e=>{(async function(e){for(;!e.shell.currentWidget;)await d(100);const t=e.shell;t.collapseLeft(),t._titleHandler.parent.setHidden(!0),t._leftHandler.sideBar.setHidden(!0);for(let e=0;e<1e3;e++){if(!t.leftCollapsed){t.collapseLeft(),t._leftHandler.sideBar.setHidden(!0);break}await d(10)}})(e).catch((e=>console.error(e)));const t=document.createElement("script");t.src="https://docs.getgrist.com/grist-plugin-api.js",t.id="grist-plugin-api",t.addEventListener("load",(async()=>{const t=window.grist;e.serviceManager.contents.fileChanged.connect((async(e,n)=>{var o;if("save"===n.type&&"notebook.ipynb"===(null===(o=n.newValue)||void 0===o?void 0:o.path)){const e={...n.newValue,content:{...n.newValue.content,cells:n.newValue.content.cells.map((e=>({...e,outputs:"outputs"in e?[]:void 0})))}};t.setOption("notebook",e)}})),t.onRecord((e=>{c=e})),t.ready();const n=await t.getOption("notebook")||l;await e.serviceManager.contents.save("notebook.ipynb",n),await e.commands.execute("filebrowser:open-path",{path:"notebook.ipynb"}),console.log("JupyterLab extension grist-widget is activated!");const o=await async function(e){for(var t,n,o;;){const i=e.shell.currentWidget,s=null===(o=null===(n=null===(t=null==i?void 0:i.context)||void 0===t?void 0:t.sessionContext)||void 0===n?void 0:n.session)||void 0===o?void 0:o.kernel;if(s)return s;await d(100)}}(e);o.requestExecute({code:i()});for(const e of r)p(e,t);await e.commands.execute("notebook:run-all-cells")})),document.head.appendChild(t)}}}}]);