language: python
python:
  - "3.9"
os: linux
dist: xenial
arch: amd64
branches:
  only:
  - master
install:
  - make init
stages:
  - tests
  - buildAndDeploy
cache: pip
jobs:
  include:
    - stage: tests
      name: "Unit tests"
      script: echo "Unit tests missing!"
    - name: "Integration tests"
      script: tox -e py39,report-xml
      after_success:
        - make submit-coverage
    - stage: buildAndDeploy
      if: branch = master
      script:
        - python3 -m build && twine upload dist/* -u $PYPI_USERNAME -p $PYPI_API_KEY
    - stage: buildAndDeploy
      if: branch = develop
      script:
        - python3 -m build && twine upload --repository testpypi dist/* -u $TEST_PYPI_USERNAME -p $TEST_PYPI_API_KEY